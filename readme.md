# College RAG Chatbot - Code Workflow

## üìã Overview
A Retrieval-Augmented Generation (RAG) chatbot that answers questions about colleges using a CSV database, vector search, and AI text generation.

---

## üîß System Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User Query     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. GREETING CHECK              ‚îÇ
‚îÇ  Is it a greeting/common phrase?‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ Yes           ‚îÇ No
         ‚ñº               ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Return ‚îÇ    ‚îÇ 2. EMBEDDING ‚îÇ
    ‚îÇGreeting‚îÇ    ‚îÇ Convert query‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ to vector    ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                                  ‚îÇ
        ‚ñº                                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3a. SEARCH DB    ‚îÇ            ‚îÇ 3b. SEARCH MEMORY‚îÇ
‚îÇ Find similar     ‚îÇ            ‚îÇ Find similar Q/A ‚îÇ
‚îÇ college records  ‚îÇ            ‚îÇ from past chats  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                               ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
                     ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ 4. FILTER & MERGE  ‚îÇ
         ‚îÇ Keep only relevant ‚îÇ
         ‚îÇ results (threshold)‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ No                  ‚îÇ Yes
         ‚ñº                     ‚ñº
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Return     ‚îÇ    ‚îÇ 5. BUILD PROMPT‚îÇ
    ‚îÇ"No Data"   ‚îÇ    ‚îÇ Context + Query‚îÇ
    ‚îÇ Message    ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
                               ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 6. GENERATE ANSWER‚îÇ
                    ‚îÇ AI Model produces ‚îÇ
                    ‚îÇ response text     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 7. SAVE TO MEMORY ‚îÇ
                    ‚îÇ Store Q/A for     ‚îÇ
                    ‚îÇ future retrieval  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ 8. RETURN ANSWER  ‚îÇ
                    ‚îÇ Display to user   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Step-by-Step Workflow

### **INITIALIZATION PHASE** (Runs once at startup)

#### Step 1: Load Configuration
- Set file paths (CSV, FAISS indexes, logs)
- Configure models (embedding, generation)
- Set parameters (top-k results, batch size, thresholds)

#### Step 2: Setup Logging
- Create file logger ‚Üí `college_rag.log`
- Create console logger ‚Üí Terminal output
- Log timestamps and events

#### Step 3: Build/Load Database
```
IF processed CSV + FAISS index exist:
    ‚Üí Load from disk (fast)
ELSE:
    ‚Üí Read colleges.csv
    ‚Üí Combine all columns into "combined" text
    ‚Üí Generate embeddings (batched for speed)
    ‚Üí Normalize vectors (for cosine similarity)
    ‚Üí Build FAISS index (IndexFlatIP)
    ‚Üí Save to disk for future use
```

#### Step 4: Initialize Memory System
```
IF memory.jsonl exists:
    ‚Üí Load past Q/A entries
IF memory.index exists:
    ‚Üí Load memory FAISS index
ELSE:
    ‚Üí Create empty memory (builds on first query)
```

#### Step 5: Load AI Models
- **Embedding Model**: `intfloat/e5-base-v2` (converts text ‚Üí vectors)
- **Generation Model**: `TinyLlama-1.1B-Chat` (generates answers)

---

### **QUERY PROCESSING PHASE** (Runs for each user question)

#### Step 6: Receive User Query
```python
User: "What are the top engineering colleges in Mumbai?"
```

#### Step 7: Check for Greetings
```
IF query matches greeting patterns:
    ‚Üí Return pre-defined friendly response
    ‚Üí SKIP to Step 14 (no RAG needed)
```

**Greeting Examples:**
- "hi" ‚Üí "Hello! How can I assist you?"
- "thank you" ‚Üí "You're very welcome! üòä"
- "bye" ‚Üí "Goodbye! üëã Keep learning."

#### Step 8: Embed Query
```python
query_text = "query: What are the top engineering colleges in Mumbai?"
query_vector = embedding_service.embed_texts([query_text])
# Result: [0.123, -0.456, 0.789, ...] (384-dim vector)
```

#### Step 9: Search Database (FAISS)
```
1. Search DB index with query vector
2. Get top-k results (default: 3)
3. Each result has:
   - Score (similarity: 0.0 to 1.0)
   - Index (row in CSV)
   
Example:
  [Score: 0.85] ‚Üí Row 42: "IIT Bombay | Mumbai | Engineering | ..."
  [Score: 0.72] ‚Üí Row 108: "VJTI | Mumbai | Engineering | ..."
  [Score: 0.68] ‚Üí Row 215: "SPIT | Mumbai | Engineering | ..."
```

#### Step 10: Search Memory (Recent Q/A)
```
1. Load past Q/A entries from memory.jsonl
2. Rebuild memory FAISS index (small, so fast)
3. Search memory with query vector
4. Get top-k_mem results (default: 3)

Example:
  [Score: 0.91] ‚Üí "Q: Best engineering colleges? A: IIT Bombay ranks..."
  [Score: 0.76] ‚Üí "Q: Mumbai colleges? A: VJTI is highly regarded..."
```

#### Step 11: Filter Results by Threshold
```
SIMILARITY_THRESHOLD = 0.2 (configurable)

For each result (DB + Memory):
    IF score >= 0.2:
        ‚Üí Keep it
    ELSE:
        ‚Üí Discard (not relevant enough)
```

#### Step 12: Build Context Block
```
1. Merge DB + Memory results
2. Sort by score (highest first)
3. Truncate texts to avoid overflow
4. Create formatted context:

Context:
---
[score:0.91] Q: Best engineering colleges? A: IIT Bombay ranks #1...
---
[score:0.85] IIT Bombay | Mumbai | Engineering | Fees: 2L/year...
---
[score:0.76] Q: Mumbai colleges? A: VJTI is highly regarded...
---
```

#### Step 13: Generate Answer

**IF NO CONTEXT FOUND:**
```python
return "I couldn't find any relevant information in my database. 
        Please provide more details (college name/program/location)."
```

**IF CONTEXT FOUND:**
```
1. Build prompt:
   - System instruction: "You are CollegeBot, concise and factual"
   - Context block (from Step 12)
   - User question
   - Rules: "Answer only from context, don't hallucinate"

2. Send to AI generation model
3. Retry up to 3 times if fails
4. Extract answer from model output
5. Clean up formatting
```

**Example Prompt:**
```
You are CollegeBot ‚Äî concise, professional, and factual.

Context:
[score:0.85] IIT Bombay | Mumbai | Engineering | Fees: 2L/year...
[score:0.72] VJTI | Mumbai | Engineering | Fees: 80K/year...

User Question: What are the top engineering colleges in Mumbai?

Instructions:
- Answer only based on the provided context
- Be concise and helpful
- Don't hallucinate

Answer:
```

**Model Output:**
```
Based on the data, the top engineering colleges in Mumbai include:
1. IIT Bombay - Premier institution with ‚Çπ2L/year fees
2. VJTI - Highly regarded with ‚Çπ80K/year fees
```

#### Step 14: Save to Memory
```python
memory_entry = {
    "id": 1698765432000,
    "question": "What are the top engineering colleges in Mumbai?",
    "answer": "Based on the data, the top engineering colleges...",
    "timestamp": "2025-10-30T10:30:45Z"
}

‚Üí Append to memory.jsonl
‚Üí Keep only last 300 entries (rolling window)
```

#### Step 15: Return Answer to User
```
üéØ Answer:
------------------------------------------------------------
Based on the data, the top engineering colleges in Mumbai include:
1. IIT Bombay - Premier institution with ‚Çπ2L/year fees
2. VJTI - Highly regarded with ‚Çπ80K/year fees
------------------------------------------------------------
```

---

## üóÇÔ∏è Data Flow Summary

```
CSV File (colleges.csv)
    ‚Üì [Read & Process]
Preprocessed CSV (colleges_processed.csv)
    ‚Üì [Generate Embeddings]
FAISS Index (colleges.index) ‚Üí Fast Vector Search
    ‚Üì
User Query ‚Üí Embedding ‚Üí Search ‚Üí Context
    ‚Üì
AI Model ‚Üí Generate Answer
    ‚Üì
memory.jsonl (Q/A History) ‚Üí Future Retrieval
```

---

## üõ†Ô∏è Key Technologies

| Component | Technology | Purpose |
|-----------|-----------|---------|
| **Embeddings** | SentenceTransformer (e5-base-v2) | Convert text ‚Üí vectors |
| **Vector Search** | FAISS (IndexFlatIP) | Fast similarity search |
| **Generation** | TinyLlama-1.1B-Chat | Generate natural answers |
| **Database** | Pandas + CSV | Store college data |
| **Memory** | JSONL + FAISS | Store past Q/A |
| **Logging** | Python logging | Track events |

---

## üìä Performance Features

1. **Batched Embeddings**: Process 64 texts at once (faster than one-by-one)
2. **Normalized Vectors**: Use cosine similarity via inner product (efficient)
3. **Persistent Indexes**: Load pre-built FAISS indexes (skip re-computation)
4. **Threshold Filtering**: Discard low-quality results (cleaner answers)
5. **Memory System**: Learn from past conversations (improves over time)
6. **Retry Logic**: Handle generation failures gracefully

---

## üéØ Usage Example

```bash
$ python college_rag_chatbot.py

üéì College RAG Chatbot ‚Äî type 'exit' or 'quit' to stop.

You: hi
üéØ Answer: Hello! How can I assist you with college or course info today?

You: What are the fees for IIT Bombay?
[Searches DB ‚Üí Finds IIT Bombay record ‚Üí Generates answer]
üéØ Answer: IIT Bombay's tuition fees are approximately ‚Çπ2 lakh per year...

You: thank you
üéØ Answer: You're very welcome! üòä

You: exit
üëã Goodbye!
```

---

## üìù Configuration Guide

### Adjust Performance
```python
TOP_K = 3              # More results = better context (slower)
BATCH_SIZE = 64        # Larger = faster (needs more memory)
SIMILARITY_THRESHOLD = 0.2  # Higher = stricter (fewer results)
```

### Change Models
```python
EMBED_MODEL_NAME = "intfloat/e5-base-v2"  # Swap for different embeddings
GEN_MODEL = "TinyLlama/TinyLlama-1.1B-Chat-v1.0"  # Use larger LLMs
```

### Memory Settings
```python
MEMORY_MAX_ENTRIES = 300  # Keep last N Q/A pairs
TOP_K_MEM = 3            # How many memory results to retrieve
```

---

## üêõ Error Handling

1. **No Data Found**: Returns polite "no information" message
2. **Generation Failure**: Retries 3 times, then shows error message
3. **Index Missing**: Rebuilds from CSV automatically
4. **Memory Corruption**: Rebuilds memory index on next query

---

## üìÇ File Structure

```
project/
‚îú‚îÄ‚îÄ college_rag_chatbot.py      # Main code
‚îú‚îÄ‚îÄ colleges.csv                # Input data
‚îú‚îÄ‚îÄ colleges_processed.csv      # Preprocessed data
‚îú‚îÄ‚îÄ colleges.index              # DB FAISS index
‚îú‚îÄ‚îÄ memory.jsonl                # Q/A history
‚îú‚îÄ‚îÄ memory.index                # Memory FAISS index
‚îî‚îÄ‚îÄ college_rag.log             # Logs
```

---

## üéì Summary

This chatbot uses **RAG (Retrieval-Augmented Generation)** to answer college-related questions:

1. **Retrieve** relevant info from database + memory
2. **Augment** the query with context
3. **Generate** natural language answer using AI

The system is fast (batched operations), persistent (saves indexes), and learns over time (memory system). Perfect for building educational assistants! üöÄ